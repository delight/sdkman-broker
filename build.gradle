buildscript {
  repositories {
    jcenter()
  }
  dependencies {
    classpath "io.ratpack:ratpack-gradle:1.3.3"
    classpath "com.github.jengelman.gradle.plugins:shadow:1.2.3"
  }
}

apply plugin: "io.ratpack.ratpack-java"
apply plugin: "com.github.johnrengelman.shadow"
apply plugin: "idea"
apply plugin: "groovy"

repositories {
  jcenter()
}

dependencies {
  runtime "org.slf4j:slf4j-simple:1.7.12"
  compile ratpack.dependency("guice")
  compile "org.mongodb:mongo-java-driver:3.2.2"
  compile "org.slf4j:slf4j-simple:1.7.5"
  testCompile "org.codehaus.groovy:groovy-all:2.4.7"
  testCompile "org.spockframework:spock-core:1.0-groovy-2.4"
  testCompile "info.cukes:cucumber-junit:1.1.8"
  testCompile "info.cukes:cucumber-groovy:1.1.8"
  testCompile "com.github.groovy-wslite:groovy-wslite:0.8.0"
}

mainClassName = "io.sdkman.broker.Main"

configurations {
  funTestCompile.extendsFrom testCompile
  funTestRuntime.extendsFrom testRuntime
}

sourceSets {
  funtest {
    groovy.srcDir file("src/funtest/groovy")
    resources.srcDir     file("src/funtest/resources")
    compileClasspath = sourceSets.main.output + sourceSets.test.output + configurations.funTestCompile
    runtimeClasspath = output + compileClasspath + configurations.funTestRuntime
  }
}

assemble.dependsOn shadowJar

task funtest(type: Test) {
  testClassesDir = sourceSets.funtest.output.classesDir
  classpath = sourceSets.funtest.runtimeClasspath
}

check.dependsOn funtest
